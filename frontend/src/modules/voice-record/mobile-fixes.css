/* Mobile-specific audio fixes to prevent phone call output */

/* Prevent automatic audio routing to phone call output */
audio, video {
  /* Force media playback through main speaker, not earpiece */
  audio-output: speaker;
  -webkit-audio-output: speaker;
}

/* Ensure audio context stays active */
.audio-context-manager {
  position: absolute;
  top: -9999px;
  left: -9999px;
  width: 1px;
  height: 1px;
  opacity: 0;
  pointer-events: none;
}

/* Mobile-specific audio routing fixes */
@media (max-width: 768px) {
  /* iOS Safari specific fixes */
  @supports (-webkit-touch-callout: none) {
    .voice-record-container {
      /* Prevent audio context suspension */
      -webkit-transform: translateZ(0);
      transform: translateZ(0);
    }

    /* Force speaker output on iOS */
    audio::-webkit-media-controls-start-playback-button {
      /* Hide the playback button to prevent context switching */
      display: none;
    }
  }

  /* Android Chrome specific fixes */
  @media screen and (-webkit-min-device-pixel-ratio: 0) and (min-resolution: .001dpcm) {
    .voice-record-container {
      /* Maintain audio context */
      webkit-app-region: no-drag;
    }
  }
}

/* Prevent audio routing to phone call output */
.voice-record-container {
  /* Use web audio context for better control */
  isolation: isolate;
}

/* Audio state management */
.audio-playing {
  /* Ensure speaker output when active */
  audio-output: speaker !important;
}

/* Mobile playback fixes */
.mobile-play-button {
  /* Ensure proper audio context on mobile */
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
  -webkit-user-drag: none;
}

/* Additional mobile touch fixes */
.mobile-play-button:active {
  transform: scale(0.95);
}

/* Prevent event bubbling on mobile */
.voice-record-container * {
  -webkit-tap-highlight-color: transparent;
}

/* Fix for iOS Safari touch delays */
.voice-record-container button {
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  -webkit-user-select: none;
  user-select: none;
}

/* CSS to prevent phone call audio routing */
.prevent-phone-output {
  /* Force media output through speaker */
  audio-output: speaker;
  -webkit-audio-output: speaker;
  speaker-output: true;
}

/* iOS-specific audio fixes */
@supports (-webkit-touch-callout: none) {
  /* iPhone specific speaker routing */
  .voice-record-container {
    /* Prevent iOS from routing to earpiece */
    -webkit-user-select: none;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }

  /* Force speaker output for all audio elements */
  .voice-record-container audio {
    /* Force use of main speaker instead of receiver */
    -webkit-appearance: none;
    appearance: none;
    audio-output: speaker !important;
    -webkit-audio-output: speaker !important;
  }

  /* iOS Safari specific: Prevent automatic audio routing to phone call */
  .voice-record-container audio::-webkit-media-controls-panel {
    display: none !important;
  }

  /* Ensure audio context stays in speaker mode */
  .ios-speaker-force {
    position: absolute;
    width: 1px;
    height: 1px;
    opacity: 0;
    pointer-events: none;
    z-index: -9999;
    left: -9999px;
    top: -9999px;
  }

  /* Prevent iOS from switching to phone call mode */
  .voice-record-container * {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
  }
}